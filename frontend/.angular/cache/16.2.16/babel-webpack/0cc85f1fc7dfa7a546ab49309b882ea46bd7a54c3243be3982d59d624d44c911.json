{"ast":null,"code":"import { BehaviorSubject, of } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class NotificationService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = 'http://localhost:8080/api/notifications';\n    this.notificationsSubject = new BehaviorSubject([]);\n    this.notifications$ = this.notificationsSubject.asObservable();\n    this.notificationCountSubject = new BehaviorSubject(0);\n    this.notificationCount$ = this.notificationCountSubject.asObservable();\n  }\n  loadNotifications(userId) {\n    this.http.get(`${this.apiUrl}/user/${userId}`).pipe(catchError(error => {\n      console.error(`Erreur lors du chargement des notifications pour l'utilisateur avec ID ${userId}:`, error);\n      this.notificationsSubject.next([]);\n      this.updateNotificationCount();\n      return of([]);\n    })).subscribe(notifications => {\n      this.notificationsSubject.next(notifications);\n      this.updateNotificationCount();\n    });\n  }\n  loadUnreadNotifications(userId) {\n    this.http.get(`${this.apiUrl}/user/${userId}/unread`).pipe(catchError(error => {\n      console.error(`Erreur lors du chargement des notifications non lues pour l'utilisateur avec ID ${userId}:`, error);\n      this.notificationsSubject.next([]);\n      this.updateNotificationCount();\n      return of([]);\n    })).subscribe(notifications => {\n      this.notificationsSubject.next(notifications);\n      this.updateNotificationCount();\n    });\n  }\n  markAsRead(notificationId) {\n    this.http.post(`${this.apiUrl}/${notificationId}/read`, {}).pipe(catchError(error => {\n      console.error(`Erreur lors du marquage de la notification avec ID ${notificationId} comme lue:`, error);\n      return of(null);\n    })).subscribe(() => {\n      const notifications = this.notificationsSubject.getValue().map(n => n.id === notificationId ? {\n        ...n,\n        read: true\n      } : n);\n      this.notificationsSubject.next(notifications);\n      this.updateNotificationCount();\n    });\n  }\n  clearNotifications(userId) {\n    this.http.delete(`${this.apiUrl}/user/${userId}`).pipe(catchError(error => {\n      console.error(`Erreur lors de la suppression des notifications pour l'utilisateur avec ID ${userId}:`, error);\n      return of(null);\n    })).subscribe(() => {\n      this.notificationsSubject.next([]);\n      this.updateNotificationCount();\n    });\n  }\n  updateNotificationCount() {\n    const unreadCount = this.notificationsSubject.getValue().filter(n => !n.read).length;\n    this.notificationCountSubject.next(unreadCount);\n  }\n  static {\n    this.ɵfac = function NotificationService_Factory(t) {\n      return new (t || NotificationService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: NotificationService,\n      factory: NotificationService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","of","catchError","NotificationService","constructor","http","apiUrl","notificationsSubject","notifications$","asObservable","notificationCountSubject","notificationCount$","loadNotifications","userId","get","pipe","error","console","next","updateNotificationCount","subscribe","notifications","loadUnreadNotifications","markAsRead","notificationId","post","getValue","map","n","id","read","clearNotifications","delete","unreadCount","filter","length","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\Users\\ghada\\Desktop\\4eme_TWIN\\projet_Microservice\\frontend\\src\\app\\services\\notification.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, of } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\n\r\nexport interface Notification {\r\n  id: string;\r\n  message: string;\r\n  postId: string;\r\n  read: boolean;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NotificationService {\r\n  private apiUrl = 'http://localhost:8080/api/notifications';\r\n  private notificationsSubject = new BehaviorSubject<Notification[]>([]);\r\n  public notifications$: Observable<Notification[]> = this.notificationsSubject.asObservable();\r\n\r\n  private notificationCountSubject = new BehaviorSubject<number>(0);\r\n  public notificationCount$: Observable<number> = this.notificationCountSubject.asObservable();\r\n\r\n  constructor(private http: HttpClient) {}\r\n\r\n  loadNotifications(userId: string): void {\r\n    this.http.get<Notification[]>(`${this.apiUrl}/user/${userId}`).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        console.error(`Erreur lors du chargement des notifications pour l'utilisateur avec ID ${userId}:`, error);\r\n        this.notificationsSubject.next([]);\r\n        this.updateNotificationCount();\r\n        return of([]);\r\n      })\r\n    ).subscribe(notifications => {\r\n      this.notificationsSubject.next(notifications);\r\n      this.updateNotificationCount();\r\n    });\r\n  }\r\n\r\n  loadUnreadNotifications(userId: string): void {\r\n    this.http.get<Notification[]>(`${this.apiUrl}/user/${userId}/unread`).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        console.error(`Erreur lors du chargement des notifications non lues pour l'utilisateur avec ID ${userId}:`, error);\r\n        this.notificationsSubject.next([]);\r\n        this.updateNotificationCount();\r\n        return of([]);\r\n      })\r\n    ).subscribe(notifications => {\r\n      this.notificationsSubject.next(notifications);\r\n      this.updateNotificationCount();\r\n    });\r\n  }\r\n\r\n  markAsRead(notificationId: string): void {\r\n    this.http.post<void>(`${this.apiUrl}/${notificationId}/read`, {}).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        console.error(`Erreur lors du marquage de la notification avec ID ${notificationId} comme lue:`, error);\r\n        return of(null);\r\n      })\r\n    ).subscribe(() => {\r\n      const notifications = this.notificationsSubject.getValue().map(n =>\r\n        n.id === notificationId ? { ...n, read: true } : n\r\n      );\r\n      this.notificationsSubject.next(notifications);\r\n      this.updateNotificationCount();\r\n    });\r\n  }\r\n\r\n  clearNotifications(userId: string): void {\r\n    this.http.delete<void>(`${this.apiUrl}/user/${userId}`).pipe(\r\n      catchError((error: HttpErrorResponse) => {\r\n        console.error(`Erreur lors de la suppression des notifications pour l'utilisateur avec ID ${userId}:`, error);\r\n        return of(null);\r\n      })\r\n    ).subscribe(() => {\r\n      this.notificationsSubject.next([]);\r\n      this.updateNotificationCount();\r\n    });\r\n  }\r\n\r\n  private updateNotificationCount(): void {\r\n    const unreadCount = this.notificationsSubject.getValue().filter(n => !n.read).length;\r\n    this.notificationCountSubject.next(unreadCount);\r\n  }\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}